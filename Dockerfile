FROM node:18-alpine AS base
RUN apk add --update git tini python3 make g++ && rm -rf /var/cache/apk/*
WORKDIR /home/node
COPY --chown=node:node . ./
FROM base AS dependencies
ENV LOG_OUTPUT_MODE=short
USER node
RUN npm config set update-notifier false
RUN npm install --no-audit
RUN npm test
RUN npm prune --production
RUN rm -rf spec* .circleci README.md LICENSE .idea
FROM node:18-alpine AS release
LABEL elastic.io.component="{\"title\":\"Transformation\",\"version\":\"1.0.13\",\"description\":\"Generic Data Transformation Component\",\"docsUrl\":\"https://docs.elastic.io/components/jsonata/index.html\",\"actions\":{\"transform\":{\"title\":\"Transform\",\"main\":\"./lib/actions/transform.js\",\"fields\":{\"expression\":{\"label\":\"JSONata Expression\",\"required\":true,\"viewClass\":\"JSONataView\"}},\"metadata\":{\"out\":{}}}},\"sailor_version\":\"2.7.7\",\"language\":\"nodejs\"}"
LABEL elastic.io.logo="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"
WORKDIR /home/node
COPY --from=base --chown=node:node /sbin/tini /sbin/tini
COPY --from=dependencies --chown=node:node /home/node /home/node
USER node
ENTRYPOINT ["/sbin/tini", "-v", "-e", "143", "--"]